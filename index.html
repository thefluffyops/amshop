<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="color-scheme" content="dark"/>
<title>AM Shop â€” Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  darkMode:'class',
  theme:{
    extend:{
      colors:{
        bg0:'#05070D',
        bg1:'#0B1020',
        glass:'rgba(255,255,255,.06)',
        glass2:'rgba(255,255,255,.09)',
        stroke:'rgba(255,255,255,.10)',
        text:'rgba(250,253,255,.96)',
        muted:'rgba(250,253,255,.66)',
        muted2:'rgba(250,253,255,.48)',
        accent:'#FFD400',
        accent2:'#FFB800',
        good:'#2EE59D',
        bad:'#FF4D4D'
      }
    }
  }
}
</script>
</head>

<body class="min-h-screen bg-[linear-gradient(180deg,#05070D,#0B1020)] text-text font-sans">

<div class="relative z-10 mx-auto max-w-[980px] px-4 pb-32 pt-6">

<!-- HEADER -->
<header class="mb-4">
  <h1 class="text-2xl font-black tracking-wide">AM Shop</h1>
  <p class="text-muted text-sm">Catalogue premium â€¢ Commande en privÃ©</p>
</header>

<!-- SEARCH -->
<div class="mb-4">
  <input id="q"
    type="search"
    placeholder="Recherche : produit, rÃ©fÃ©rence, tagâ€¦"
    class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 outline-none"/>
</div>

<!-- FILTERS -->
<div id="chipsRow" class="flex gap-2 overflow-x-auto mb-4"></div>

<!-- LIST -->
<div class="flex items-center justify-between mb-2">
  <div class="font-black text-sm">Catalogue</div>
  <div id="countInfo" class="text-xs text-muted">â€”</div>
</div>

<div id="list" class="flex flex-col gap-3"></div>

<div id="emptyState" class="hidden text-center text-muted text-sm mt-4">
  Aucun produit trouvÃ©.
</div>

</div>

<!-- BOTTOM CART BAR -->
<div class="fixed bottom-0 left-0 right-0 bg-bg1 border-t border-white/10 px-4 py-3">
  <div class="max-w-[980px] mx-auto flex justify-between items-center">
    <div>
      <div class="font-black text-sm">ðŸ›’ Panier</div>
      <div id="cartHint" class="text-xs text-muted">Aucun article</div>
    </div>
    <div id="cartCountBadge"
      class="px-3 py-1 rounded-full bg-accent text-black font-black">0</div>
  </div>
</div>

<script>

/* ================= DATA ================= */

const PRODUCTS = [
  {id:"AM-01",name:"Mousseux",category:"Catalogue",origin:"ðŸ‡²ðŸ‡¦",quality:"Premium",price:10,desc:"Exemple",tags:["Nouveau"]},
  {id:"AM-02",name:"Frozen",category:"Catalogue",origin:"ðŸ‡³ðŸ‡±",quality:"Premium",price:15,desc:"Exemple",tags:["Stock limitÃ©"]},
  {id:"AM-03",name:"Cali US",category:"Catalogue",origin:"ðŸ‡ºðŸ‡¸",quality:"Premium",price:20,desc:"Exemple",tags:[]}
];

const CONTACT_USERNAME = "AMShopContact";
const CART_KEY = "amshop_cart_v1";
const FORM_KEY = "amshop_form_v1";

/* ================= TELEGRAM INIT ================= */

const tg = window.Telegram?.WebApp;
tg?.ready();
tg?.expand();

/* ================= STATE ================= */

const state = {
  q:"",
  filter:"ALL",
  cart: JSON.parse(localStorage.getItem(CART_KEY) || "{}"),
  form: JSON.parse(localStorage.getItem(FORM_KEY) || JSON.stringify({
    mode:"LIVRAISON",
    zone:"59",
    fullname:"",
    phone:"",
    address:"",
    note:""
  }))
};

/* ================= HELPERS ================= */

function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(state.cart)); }
function saveForm(){ localStorage.setItem(FORM_KEY, JSON.stringify(state.form)); }

function money(n){ return Number(n||0).toFixed(2)+" â‚¬"; }

function cartItems(){
  return Object.entries(state.cart).map(([id,qty])=>{
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return null;
    return {p,qty};
  }).filter(Boolean);
}

function cartTotal(){
  return cartItems().reduce((s,i)=>s+i.p.price*i.qty,0);
}

function cartCount(){
  return Object.values(state.cart).reduce((a,b)=>a+Number(b||0),0);
}

/* ================= RENDER ================= */

const el = {
  q:document.getElementById("q"),
  list:document.getElementById("list"),
  countInfo:document.getElementById("countInfo"),
  empty:document.getElementById("emptyState"),
  cartHint:document.getElementById("cartHint"),
  cartCount:document.getElementById("cartCountBadge")
};

function render(){
  const filtered = PRODUCTS.filter(p=>{
    const blob = (p.name+p.id+(p.tags||[]).join(" ")).toLowerCase();
    return blob.includes(state.q.toLowerCase());
  });

  el.list.innerHTML="";
  el.countInfo.textContent=filtered.length+" produit(s)";

  if(!filtered.length){
    el.empty.classList.remove("hidden");
  } else {
    el.empty.classList.add("hidden");
  }

  filtered.forEach(p=>{
    const qty = state.cart[p.id]||0;

    const card=document.createElement("div");
    card.className="p-4 rounded-xl border border-white/10 bg-white/5";

    card.innerHTML=`
      <div class="flex justify-between">
        <div>
          <div class="font-black">${p.name}</div>
          <div class="text-sm text-muted">${p.origin}</div>
        </div>
        <div class="font-black">${money(p.price)}</div>
      </div>

      <button class="mt-3 w-full bg-gradient-to-br from-accent to-accent2 text-black font-black p-2 rounded-xl">
        ${qty>0?"âœ” AjoutÃ© x"+qty:"+ Ajouter au panier"}
      </button>
    `;

    card.querySelector("button").onclick=()=>{
      state.cart[p.id]=(state.cart[p.id]||0)+1;
      saveCart();
      render();
    };

    el.list.appendChild(card);
  });

  const count = cartCount();
  el.cartCount.textContent=count;
  el.cartHint.textContent = count
    ? `${count} article(s) â€¢ ${money(cartTotal())}`
    : "Aucun article";
}

/* ================= EVENTS ================= */

el.q.addEventListener("input",()=>{
  state.q=el.q.value;
  render();
});

render();

</script>
</body>
</html>
