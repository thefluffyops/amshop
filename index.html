<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>AM Shop</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/framework7@8/framework7-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/framework7@8/framework7-bundle.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background: linear-gradient(180deg,#0f0f14,#1a1a22);
}
.product-rate {
  font-size: 12px;
  padding: 4px 10px;
  border-radius: 20px;
  background: #007aff;
  color: white;
}
.product-country {
  font-size: 12px;
  opacity: 0.6;
}
</style>
</head>

<body>

<div id="app">
<div class="view view-main">

<div class="page" data-name="home">

<div class="navbar">
<div class="navbar-inner sliding">
<div class="title">AM Shop</div>
</div>
</div>

<div class="page-content">

<div class="list media-list inset">
<ul id="productList"></ul>
</div>

</div>
</div>
</div>
</div>

<!-- SHEET -->
<div class="sheet-modal" id="cartSheet">
<div class="toolbar">
<div class="toolbar-inner justify-content-center">
<div class="title">Votre commande</div>
</div>
</div>
<div class="sheet-modal-inner">
<div class="list" id="cartList"></div>

<div class="block">
<div class="list">
<ul>
<li>
<div class="item-content item-input">
<div class="item-inner">
<div class="item-title item-label">Mode</div>
<div class="item-input-wrap">
<select id="modeSelect">
<option value="SUR_PLACE">Sur place</option>
<option value="COLIS">Colis</option>
<option value="LIVRAISON">Livraison</option>
</select>
</div>
</div>
</div>
</li>

<li>
<div class="item-content item-input">
<div class="item-inner">
<div class="item-title item-label">Nom</div>
<div class="item-input-wrap">
<input type="text" id="nameInput">
</div>
</div>
</div>
</li>

<li>
<div class="item-content item-input">
<div class="item-inner">
<div class="item-title item-label">Téléphone</div>
<div class="item-input-wrap">
<input type="text" id="phoneInput">
</div>
</div>
</div>
</li>

<li id="addressField" style="display:none;">
<div class="item-content item-input">
<div class="item-inner">
<div class="item-title item-label">Adresse</div>
<div class="item-input-wrap">
<input type="text" id="addressInput">
</div>
</div>
</div>
</li>

</ul>
</div>

<a href="#" id="orderBtn" class="button button-fill button-large color-blue">Commander</a>

</div>
</div>
</div>

<!-- TAB BAR -->
<div class="toolbar toolbar-bottom">
<div class="toolbar-inner">
<a href="#" id="openCart" class="link">
Panier (<span id="cartCount">0</span>)
</a>
</div>
</div>

<script>

const tg = window.Telegram?.WebApp;
tg?.ready();
tg?.expand();

const CONTACT_USERNAME = "TON_USERNAME";

const app = new Framework7({
  root: '#app',
  theme: 'ios'
});

const PRODUCTS = [
{id:"A1",name:"Frozen",price:15,rate:31,country:"USA"},
{id:"A2",name:"Cali US",price:20,rate:28,country:"USA"},
{id:"A3",name:"Cali NL",price:10,rate:24,country:"Pays-Bas"}
];

let cart = {};

const productList = document.getElementById("productList");
const cartList = document.getElementById("cartList");
const cartCount = document.getElementById("cartCount");
const sheet = app.sheet.create({ el: '#cartSheet' });

function renderProducts(){
productList.innerHTML="";
PRODUCTS.forEach(p=>{
const li = document.createElement("li");
li.innerHTML=`
<a href="#" class="item-link item-content">
<div class="item-inner">
<div class="item-title-row">
<div class="item-title">${p.name}</div>
<div class="item-after">${p.price}€ / g</div>
</div>
<div class="item-subtitle">
<span class="product-rate">${p.rate}%</span>
<span class="product-country">${p.country}</span>
</div>
</div>
</a>
`;
li.onclick=()=>{
cart[p.id]=(cart[p.id]||0)+1;
renderCart();
};
productList.appendChild(li);
});
}

function renderCart(){
cartList.innerHTML="";
let total=0;
let count=0;

Object.entries(cart).forEach(([id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
total+=p.price*qty;
count+=qty;

const div=document.createElement("div");
div.className="block";
div.innerHTML=`${p.name} x${qty} - ${p.price*qty}€`;
cartList.appendChild(div);
});

cartCount.textContent=count;
}

document.getElementById("openCart").onclick=()=>sheet.open();

document.getElementById("modeSelect").onchange=(e)=>{
document.getElementById("addressField").style.display=
e.target.value==="LIVRAISON"?"block":"none";
};

document.getElementById("orderBtn").onclick=()=>{
if(Object.keys(cart).length===0){
app.dialog.alert("Panier vide");
return;
}
window.open(`https://t.me/${CONTACT_USERNAME}`);
};

renderProducts();

</script>

</body>
</html>
