<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="color-scheme" content="dark"/>
<title>AM Shop â€” Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
darkMode:'class',
theme:{
extend:{
colors:{
bg0:'#05070D',
bg1:'#0B1020',
bg2:'#11172A',
glass:'rgba(255,255,255,.06)',
glass2:'rgba(255,255,255,.09)',
stroke:'rgba(255,255,255,.10)',
text:'rgba(250,253,255,.96)',
muted:'rgba(250,253,255,.66)',
accent:'#FFD400',
accent2:'#FFB800',
good:'#2EE59D',
bad:'#FF4D4D'
},
boxShadow:{
glow:'0 0 40px rgba(255,212,0,.25)'
}
}
}
}
</script>

<style>
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,.2);border-radius:10px}
</style>
</head>

<body class="min-h-screen bg-bg0 text-text font-sans overflow-x-hidden">

<!-- Background -->
<div class="fixed inset-0 -z-10 overflow-hidden">
<div class="absolute w-[500px] h-[500px] bg-accent/20 blur-[120px] rounded-full -top-40 -left-40"></div>
<div class="absolute w-[400px] h-[400px] bg-accent2/20 blur-[120px] rounded-full -bottom-40 -right-40"></div>
</div>

<div class="relative z-10 max-w-[1000px] mx-auto px-4 pb-40 pt-6">

<header class="mb-6">
<h1 class="text-3xl font-black">AM Shop</h1>
<p class="text-muted text-sm">Catalogue premium â€¢ Commande sÃ©curisÃ©e Telegram</p>
</header>

<input id="search" type="search"
placeholder="Recherche produit..."
class="w-full mb-4 px-4 py-3 rounded-xl bg-glass border border-stroke outline-none"/>

<div id="chips" class="flex gap-2 overflow-x-auto mb-4"></div>

<div class="flex justify-between mb-2">
<div class="font-black text-sm">Catalogue</div>
<div id="countInfo" class="text-xs text-muted"></div>
</div>

<div id="products" class="grid md:grid-cols-2 gap-4"></div>
<div id="empty" class="hidden text-center text-muted mt-6">Aucun produit trouvÃ©.</div>

</div>

<!-- Bottom Bar -->
<div class="fixed bottom-0 left-0 right-0 bg-bg1 border-t border-stroke p-4">
<div class="max-w-[1000px] mx-auto flex justify-between items-center">
<button id="openCart" class="flex gap-2 items-center">
<span class="font-bold">ðŸ›’ Panier</span>
<span id="cartHint" class="text-xs text-muted">Vide</span>
</button>
<div id="cartBadge" class="px-3 py-1 rounded-full bg-accent text-black font-black">0</div>
</div>
</div>

<!-- Sheet -->
<div id="mask" class="fixed inset-0 bg-black/60 opacity-0 pointer-events-none transition"></div>

<div id="sheet"
class="fixed left-0 right-0 -bottom-full bg-bg2 border-t border-stroke rounded-t-2xl transition-all max-h-[90vh] flex flex-col">

<div class="p-4 border-b border-stroke flex justify-between">
<div class="font-black">Votre commande</div>
<button id="closeCart">âœ•</button>
</div>

<div class="p-4 flex-1 overflow-y-auto space-y-6">

<div id="cartItems"></div>
<div id="cartEmpty" class="hidden text-muted text-sm">Panier vide.</div>

<div class="flex justify-between font-bold border-t border-stroke pt-4">
<span>Total</span>
<span id="cartTotal"></span>
</div>

<div class="space-y-3 border-t border-stroke pt-6">

<select id="mode" class="w-full p-3 rounded-xl bg-glass border border-stroke">
<option value="LIVRAISON">Livraison</option>
<option value="SUR_PLACE">Sur place</option>
<option value="COLIS">Colis</option>
</select>

<input id="fullname" placeholder="Nom complet"
class="w-full p-3 rounded-xl bg-glass border border-stroke"/>

<input id="phone" placeholder="TÃ©lÃ©phone"
class="w-full p-3 rounded-xl bg-glass border border-stroke"/>

<input id="address" placeholder="Adresse complÃ¨te"
class="w-full p-3 rounded-xl bg-glass border border-stroke"/>

<textarea id="note" rows="3"
placeholder="Note (facultatif)"
class="w-full p-3 rounded-xl bg-glass border border-stroke resize-none"></textarea>

<button id="send"
class="w-full p-3 rounded-xl bg-gradient-to-br from-accent to-accent2 text-black font-black shadow-glow">
Envoyer la commande
</button>

</div>
</div>
</div>

<script>

/* ================= DATA ================= */

const CONTACT_USERNAME = "AMShopContact";

const PRODUCTS = [
{id:"AM-01",name:"Mousseux",origin:"ðŸ‡²ðŸ‡¦",price:10,tags:["Nouveau"]},
{id:"AM-02",name:"Frozen",origin:"ðŸ‡³ðŸ‡±",price:15,tags:["Top"]},
{id:"AM-03",name:"Cali US",origin:"ðŸ‡ºðŸ‡¸",price:20,tags:["Premium"]}
];

/* ================= STATE ================= */

const state={
search:"",
filter:"ALL",
cart:JSON.parse(localStorage.getItem("am_cart")||"{}"),
form:JSON.parse(localStorage.getItem("am_form")||JSON.stringify({
mode:"LIVRAISON",
fullname:"",
phone:"",
address:"",
note:""
}))
};

function save(){
localStorage.setItem("am_cart",JSON.stringify(state.cart));
localStorage.setItem("am_form",JSON.stringify(state.form));
}

/* ================= HELPERS ================= */

function money(n){return Number(n).toFixed(2)+" â‚¬";}
function cartCount(){return Object.values(state.cart).reduce((a,b)=>a+b,0);}
function cartTotal(){
return Object.entries(state.cart).reduce((sum,[id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
return sum+(p?p.price*qty:0);
},0);
}

/* ================= RENDER PRODUCTS ================= */

const productsEl=document.getElementById("products");
const emptyEl=document.getElementById("empty");
const countInfo=document.getElementById("countInfo");

function renderProducts(){

let list=PRODUCTS.filter(p=>{
return p.name.toLowerCase().includes(state.search.toLowerCase());
});

productsEl.innerHTML="";
countInfo.textContent=list.length+" produit(s)";

if(!list.length){emptyEl.classList.remove("hidden");}
else{emptyEl.classList.add("hidden");}

list.forEach(p=>{

const qty=state.cart[p.id]||0;

const card=document.createElement("div");
card.className="p-4 rounded-2xl bg-glass border border-stroke";

card.innerHTML=`
<div class="flex justify-between mb-2">
<div>
<div class="font-bold">${p.name}</div>
<div class="text-xs text-muted">${p.origin}</div>
</div>
<div class="font-bold">${money(p.price)}</div>
</div>

<button class="add w-full mt-2 p-2 rounded-xl bg-accent text-black font-bold">
${qty>0?"âœ” AjoutÃ© x"+qty:"+ Ajouter"}
</button>
`;

card.querySelector(".add").onclick=()=>{
state.cart[p.id]=(state.cart[p.id]||0)+1;
save();
renderProducts();
renderCart();
};

productsEl.appendChild(card);
});
}

/* ================= CART ================= */

const cartItemsEl=document.getElementById("cartItems");
const cartEmptyEl=document.getElementById("cartEmpty");
const cartTotalEl=document.getElementById("cartTotal");
const cartBadge=document.getElementById("cartBadge");
const cartHint=document.getElementById("cartHint");

function renderCart(){

cartItemsEl.innerHTML="";
const entries=Object.entries(state.cart);

if(!entries.length){
cartEmptyEl.classList.remove("hidden");
}else{
cartEmptyEl.classList.add("hidden");
}

entries.forEach(([id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
if(!p)return;

const row=document.createElement("div");
row.className="flex justify-between items-center bg-glass p-3 rounded-xl";

row.innerHTML=`
<div>
<div class="font-bold text-sm">${p.name}</div>
<div class="text-xs text-muted">${money(p.price)} Ã— ${qty}</div>
</div>
<div class="flex gap-2">
<button class="dec px-2 bg-glass2 rounded">-</button>
<button class="inc px-2 bg-glass2 rounded">+</button>
<button class="rem px-2 bg-bad/20 text-bad rounded">x</button>
</div>
`;

row.querySelector(".dec").onclick=()=>{
state.cart[id]=Math.max(0,qty-1);
if(state.cart[id]===0)delete state.cart[id];
save();
renderProducts();
renderCart();
};

row.querySelector(".inc").onclick=()=>{
state.cart[id]=qty+1;
save();
renderProducts();
renderCart();
};

row.querySelector(".rem").onclick=()=>{
delete state.cart[id];
save();
renderProducts();
renderCart();
};

cartItemsEl.appendChild(row);
});

cartTotalEl.textContent=money(cartTotal());
cartBadge.textContent=cartCount();
cartHint.textContent=cartCount()?cartCount()+" article(s)":"Vide";
}

/* ================= SHEET ================= */

const sheet=document.getElementById("sheet");
const mask=document.getElementById("mask");

document.getElementById("openCart").onclick=()=>{
sheet.style.bottom="0";
mask.classList.remove("opacity-0","pointer-events-none");
};

document.getElementById("closeCart").onclick=closeSheet;
mask.onclick=closeSheet;

function closeSheet(){
sheet.style.bottom="-100%";
mask.classList.add("opacity-0","pointer-events-none");
}

/* ================= FORM ================= */

["mode","fullname","phone","address","note"].forEach(id=>{
document.getElementById(id).value=state.form[id]||"";
document.getElementById(id).oninput=(e)=>{
state.form[id]=e.target.value;
save();
};
});

/* ================= SEND ================= */

document.getElementById("send").onclick=()=>{

if(!cartCount())return alert("Panier vide");
if(state.form.fullname.length<2)return alert("Nom invalide");
if(state.form.phone.length<6)return alert("TÃ©lÃ©phone invalide");

let text="ðŸ“¦ Ma Commande AM Shop\n\n";
Object.entries(state.cart).forEach(([id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
text+=`â€¢ ${p.name} x${qty} = ${money(p.price*qty)}\n`;
});
text+=`\nTotal : ${money(cartTotal())}\n`;
text+=`\nMode : ${state.form.mode}\n`;
text+=`Nom : ${state.form.fullname}\n`;
text+=`TÃ©lÃ©phone : ${state.form.phone}\n`;
if(state.form.mode==="LIVRAISON"){
text+=`Adresse : ${state.form.address}\n`;
}
if(state.form.note){
text+=`Note : ${state.form.note}\n`;
}

navigator.clipboard.writeText(text).catch(()=>{});
window.open(`https://t.me/${CONTACT_USERNAME}?text=${encodeURIComponent(text)}`,"_blank");
};

/* ================= INIT ================= */

document.getElementById("search").oninput=(e)=>{
state.search=e.target.value;
renderProducts();
};

renderProducts();
renderCart();

</script>

</body>
</html>
