<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AM Shop</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
darkMode:"class",
theme:{
extend:{
colors:{
bg:"#0B1020",
card:"#111827",
accent:"#FFD400",
accent2:"#FFB800"
}
}
}
}
</script>
</head>

<body class="bg-bg text-white min-h-screen">

<div class="max-w-4xl mx-auto p-4 pb-32">

<h1 class="text-3xl font-black mb-6">AM Shop</h1>

<input id="search" placeholder="Recherche..."
class="w-full p-3 rounded-xl bg-card mb-4 outline-none">

<div id="products" class="grid gap-4"></div>

</div>

<!-- BOTTOM CART -->
<div id="cartBar"
class="fixed bottom-0 left-0 right-0 bg-card border-t border-white/10 p-4 flex justify-between items-center cursor-pointer">

<div>
<div class="font-bold">üõí Panier</div>
<div id="cartInfo" class="text-sm opacity-70">0 article</div>
</div>

<div id="cartCount"
class="bg-accent text-black font-bold px-3 py-1 rounded-full">
0
</div>

</div>

<!-- SHEET -->
<div id="overlay"
class="fixed inset-0 bg-black/60 hidden"></div>

<div id="sheet"
class="fixed left-0 right-0 bottom-0 bg-card rounded-t-3xl p-6 translate-y-full transition-transform duration-300 max-h-[90vh] overflow-y-auto">

<h2 class="text-xl font-black mb-4">Votre commande</h2>

<div id="cartItems" class="space-y-3 mb-4"></div>

<div class="border-t border-white/10 pt-4 space-y-3">

<select id="mode" class="w-full p-3 bg-bg rounded-xl">
<option value="LIVRAISON">Livraison</option>
<option value="SUR_PLACE">Sur place</option>
<option value="COLIS">Colis</option>
</select>

<input id="name" placeholder="Nom"
class="w-full p-3 bg-bg rounded-xl">

<input id="phone" placeholder="T√©l√©phone"
class="w-full p-3 bg-bg rounded-xl">

<input id="address" placeholder="Adresse"
class="w-full p-3 bg-bg rounded-xl">

<button id="orderBtn"
class="w-full bg-gradient-to-r from-accent to-accent2 text-black font-bold p-3 rounded-xl">
Commander
</button>

</div>

</div>

<script>

const tg = window.Telegram?.WebApp;
tg?.ready();
tg?.expand();

const CONTACT_USERNAME = "TON_USERNAME";

/* =========================
   PRODUITS
========================= */
const PRODUCTS = [
{id:"A1",name:"Frozen",price:15,rate:31,country:"USA"},
{id:"A2",name:"Cali US",price:20,rate:28,country:"USA"},
{id:"A3",name:"Cali NL",price:10,rate:24,country:"Pays-Bas"}
];

/* =========================
   STATE
========================= */
let cart = JSON.parse(localStorage.getItem("am_cart")||"{}");

const productsDiv=document.getElementById("products");
const cartBar=document.getElementById("cartBar");
const sheet=document.getElementById("sheet");
const overlay=document.getElementById("overlay");
const cartItems=document.getElementById("cartItems");
const cartInfo=document.getElementById("cartInfo");
const cartCount=document.getElementById("cartCount");

const modeSelect=document.getElementById("mode");
const nameInput=document.getElementById("name");
const phoneInput=document.getElementById("phone");
const addressInput=document.getElementById("address");

/* =========================
   HELPERS
========================= */
function saveCart(){
localStorage.setItem("am_cart",JSON.stringify(cart));
renderCart();
}

function cartTotal(){
return Object.entries(cart).reduce((total,[id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
return total + (p.price*qty);
},0);
}

function cartCountTotal(){
return Object.values(cart).reduce((a,b)=>a+b,0);
}

/* =========================
   PRODUITS (AM√âLIOR√âS)
========================= */
function renderProducts(){
productsDiv.innerHTML="";

PRODUCTS.forEach(p=>{

const div=document.createElement("div");
div.className="bg-card p-5 rounded-2xl flex justify-between items-center shadow-lg border border-white/5";

div.innerHTML=`
<div class="space-y-2">

<div class="flex items-center gap-3">
<div class="text-lg font-black">${p.name}</div>
<div class="bg-accent text-black text-xs font-bold px-2 py-1 rounded-full">
${p.rate}%
</div>
</div>

<div class="text-sm opacity-70">
üåç ${p.country}
</div>

<div class="text-sm font-semibold">
${p.price} ‚Ç¨ <span class="opacity-60 text-xs">/ gramme</span>
</div>

</div>

<button class="bg-gradient-to-r from-accent to-accent2 text-black px-4 py-2 rounded-xl font-bold hover:scale-105 transition">
Ajouter
</button>
`;

div.querySelector("button").onclick=()=>{
cart[p.id]=(cart[p.id]||0)+1;
saveCart();
};

productsDiv.appendChild(div);
});
}

/* =========================
   CART BAR
========================= */
function renderCart(){
const count=cartCountTotal();
cartCount.textContent=count;
cartInfo.textContent=count>0
? count+" article(s) ‚Ä¢ "+cartTotal()+" ‚Ç¨"
: "Panier vide";
}

/* =========================
   SHEET
========================= */
function openSheet(){
overlay.classList.remove("hidden");
sheet.classList.remove("translate-y-full");
renderSheet();
}

function closeSheet(){
overlay.classList.add("hidden");
sheet.classList.add("translate-y-full");
}

/* =========================
   RENDER SHEET
========================= */
function renderSheet(){

cartItems.innerHTML="";

if(cartCountTotal()===0){
cartItems.innerHTML="<div class='text-center opacity-60'>Panier vide</div>";
return;
}

Object.entries(cart).forEach(([id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
const lineTotal=p.price*qty;

const div=document.createElement("div");
div.className="bg-bg p-4 rounded-xl space-y-3";

div.innerHTML=`
<div class="flex justify-between">
<div class="font-bold">${p.name}</div>
<div>${lineTotal} ‚Ç¨</div>
</div>

<div class="flex justify-between items-center">
<div class="flex items-center gap-3">
<button class="dec bg-card px-3 rounded">-</button>
<span>${qty}</span>
<button class="inc bg-card px-3 rounded">+</button>
</div>
<button class="remove text-red-400 text-sm">Retirer</button>
</div>
`;

div.querySelector(".inc").onclick=()=>{
cart[id]++;
saveCart();
renderSheet();
};

div.querySelector(".dec").onclick=()=>{
cart[id]--;
if(cart[id]<=0) delete cart[id];
saveCart();
renderSheet();
};

div.querySelector(".remove").onclick=()=>{
delete cart[id];
saveCart();
renderSheet();
};

cartItems.appendChild(div);
});

const totalDiv=document.createElement("div");
totalDiv.className="border-t border-white/10 pt-4 text-right font-bold text-lg";
totalDiv.innerHTML="Total : "+cartTotal()+" ‚Ç¨";
cartItems.appendChild(totalDiv);
}

/* =========================
   MODE UI
========================= */
modeSelect.onchange=()=>{
if(modeSelect.value==="LIVRAISON"){
addressInput.classList.remove("hidden");
}else{
addressInput.classList.add("hidden");
}
};

/* =========================
   BUILD MESSAGE
========================= */
function buildMessage(){

let txt="üì¶ Commande AM Shop\n\n";

Object.entries(cart).forEach(([id,qty])=>{
const p=PRODUCTS.find(x=>x.id===id);
txt+=`‚Ä¢ ${p.name} x${qty} = ${p.price*qty} ‚Ç¨\n`;
});

txt+=`\nüí∞ Total : ${cartTotal()} ‚Ç¨\n\n`;

txt+="üìç Infos client\n";
txt+=`Mode : ${modeSelect.value}\n`;
txt+=`Nom : ${nameInput.value||"-"}\n`;
txt+=`T√©l√©phone : ${phoneInput.value||"-"}\n`;

if(modeSelect.value==="LIVRAISON"){
txt+=`Adresse : ${addressInput.value||"-"}\n`;
}

return txt;
}

/* =========================
   ORDER
========================= */
document.getElementById("orderBtn").onclick=()=>{

if(cartCountTotal()===0){
alert("Panier vide");
return;
}

if(!nameInput.value || !phoneInput.value){
alert("Nom et t√©l√©phone obligatoires");
return;
}

if(modeSelect.value==="LIVRAISON" && !addressInput.value){
alert("Adresse requise pour livraison");
return;
}

const message=buildMessage();

window.open(
`https://t.me/${CONTACT_USERNAME}?text=${encodeURIComponent(message)}`
);

};

cartBar.onclick=openSheet;
overlay.onclick=closeSheet;

renderProducts();
renderCart();

</script>

</body>
</html>
